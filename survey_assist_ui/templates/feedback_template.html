{% extends "core.html" %}
{% from "components/button/_macro.njk" import onsButton %}
{% from "components/radios/_macro.njk" import onsRadios %}
{% from "components/input/_macro.njk" import onsInput %}
{% from "components/textarea/_macro.njk" import onsTextarea %}
{% from "components/question/_macro.njk" import onsQuestion %}
{%
    set pageConfig = {
        "meta": {
            "canonicalUrl": "/",
            "description": "/",
        },
        "header": {
            "title": 'Feedback Question',
            "orgLogoHref": 'https://www.ons.gov.uk',
            "titleLogoHref": "/",
            "mastheadLogo": {
              "large": '<img class="logo" src="https://cdn.ons.gov.uk/assets/images/ons-logo/v2/ons-logo.svg" height="150" width="250" alt="Office for National Statistics logo">'
            },
            "titleLogo": "/",
            "navigation": navigation.navigation,
        },
        "breadcrumbs": {
            "ariaLabel": 'Breadcrumbs',
            "itemsList": [
                {
                    "url": url_for('main.index'),
                    "text": 'Previous'
                }
            ]
        }
    }
%}
{% block main %}
    <form method="POST" action="{{ url_for('feedback.feedback_response') }}">
        <input type="hidden" name="question_name" value="{{ question_name }}">

        {# Build the base options object #}
        {% set question_opts = {
        "title": question_text,
        "description": question_description,
        "classes": "ons-u-mt-no",
        "legendIsQuestionTitle": true
        } %}

        {# Add optional sections only when enabled #}
        {% if guidance_enabled %}
        {% set _ = question_opts.update({
            "guidance": { "content": guidance_text }
        }) %}
        {% endif %}

        {% if justification_enabled %}
        {% set _ = question_opts.update({
            "justification": {
            "title": justification_title,
            "content": justification_text
            }
        }) %}
        {% endif %}

        {# Single render, inner control just for the response widget #}
        {% call onsQuestion(question_opts) %}
        {% if response_type == "radio" %}
            {{ onsRadios({
            "name": response_name,
            "dontWrap": true,
            "radios": response_options
            }) }}
        {% elif response_type == "text" %}
            {{ onsInput({
            "id": response_name,
            "name": response_name,
            "type": "text",
            "searchButton": false,
            "attributes": { "required": true }
            }) }}
        {% elif response_type == "textarea" %}
            {{
            onsTextarea({
                "id": response_name,
                "name": response_name,
                "width": "30",
                "charCheckLimit": {
                    "limit": 200,
                    "charCountSingular": "You have {x} character remaining",
                    "charCountPlural": "You have {x} characters remaining",
                    "charCountOverLimitSingular": "{x} character too many",
                    "charCountOverLimitPlural": "{x} characters too many"
                }
            })
            }}
        {% endif %}
        {% endcall %}
        
        {{ onsButton({
            "id": "save-values-button",
            "text": button_text,
            }) 
        }}
    </form>
{% endblock %}
